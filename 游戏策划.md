# 塔防 Roguelike · 游戏策划与规则说明

本文档记录当前版本的核心规则与系统，便于后续扩展与交接。  
**与 AI 协作时**：新对话请先让 AI 阅读本文件与 `项目上下文.md`，以便无缝延续并记住你的约定。

---

## 一、核心玩法

- **类型**：塔防 + Roguelike，单角色站桩输出。
- **目标**：玩家站在左侧，右侧不断刷怪向左移动；玩家在攻击范围内自动普攻，击杀获得经验与金币，升级选技能，撑过 20 波并存活即通关。
- **失败**：玩家生命归零即游戏结束。

---

## 二、战斗与数值

### 2.1 玩家

- **位置**：固定于画面左侧（x=50），垂直居中于游戏区。
- **属性与英雄类型**：
  - 三种属性：**力量**、**敏捷**、**智力**。英雄**大类型**分为力量英雄、敏捷英雄、智力英雄；每个大类型下可有多个**职业**（如力量英雄下有「狂暴战」），职业决定初始属性与**升级成长**。
  - **主属性**决定攻击力：力量英雄看力量、敏捷英雄看敏捷、智力英雄看智力，主属性越高攻击力基础值越高。
  - **共性**：**力量**主要影响生命上限（力量越高血量越高）。**敏捷**不再通用影响攻速，攻速改由副属性**极速**影响；智力当前仅预留，后续智力英雄再扩展。
- **副属性**：**暴击**：底层为**暴击数值**，换算为暴击率：暴击率 = 暴击/(暴击+100)，如 100 暴击=50% 率、25 暴击≈20% 率；暴击时伤害 200%（2 倍）。**极速**：底层为**极速数值**，1 极速=攻速与 CD 效果+1%（100 极速=间隔与 CD 时间减半）。装备/技能可加暴击数值或极速数值，界面显示为「暴击 X (Y%)」「极速 Z (攻速/CD+Z%)」。
  - **升级成长**：每次升级时，按当前职业的成长值增加属性（如狂暴战：每级 +2 力量、+1 敏捷、+0 智力），然后按新力量重算基础生命上限，再叠加工会/装备的额外生命。
- **职业·狂暴战**（当前唯一）：大类型力量英雄；初始力 15、敏 10、智 10；每升 1 级 +2 力、+1 敏、+0 智；初始血量 800。**开局自带技能**：嗜血、旋风斩、暴怒（暴击专精、极速专精可通过升级 3 选 1 获得）。**开局自带装备**：狂暴战刃（占装备栏第 1 格，+50 攻击、怒气获取 +30%，专属不可掉落）。
- **生命**：基础最大生命 = 200 + 力量×40（狂暴战 15 力即 800），可被商店「生命上限」与装备继续增加。
- **攻击**：基础攻击 = 5 + 主属性×0.2（力量英雄 15 力即 8），再 × 所有已学技能倍率 × 已激活套装倍率 × 商店永久加成 × 装备加成。
- **攻速**：基础攻击间隔再除以技能/套装/商店/装备的攻速倍率，以及**极速**（每 100 极速使攻速与 CD 速率翻倍）；敏捷不再参与攻速计算。
- **攻击范围**：以玩家为圆心、向右的半圆，半径至少覆盖游戏区上下边。
- **怒气**（仅**战士**职业，如狂暴战；职业配置 `hasRage: true`）：怒气上限 100。**获得**：**普通攻击**命中一次 +5 怒气，暴击额外 +5；**嗜血**释放时额外 +10 怒气。旋风斩、顺劈等技能造成伤害不再获得怒气。当前战士不受击获得怒气，后续其他战士职业可单独配置「受到攻击获得怒气」。界面仅在当前职业为战士时显示怒气条与数值。后续可扩展为消耗怒气强化技能等。
- **主动技能·嗜血**：已加入基础技能池（id 12），**狂暴战开局即拥有**（占技能栏 1 格）。立即对当前目标造成 **150%** 攻击力伤害，并**回复造成伤害的 20%** 生命；并在**后续 3 秒**内攻速提升至 **1.2 倍**。**战士**释放嗜血时**额外获得 10 点怒气**。冷却 **4 秒**，无目标时无法释放；CD 转好且有目标时自动释放。技能栏中嗜血格会显示 **CD Xs** / **就绪** / **攻速+**（buff 中）。
- **主动技能·旋风斩**：已加入基础技能池（id 15），**狂暴战开局即拥有**（占技能栏 1 格）。对攻击范围内**最多 5 个敌人**各造成 **80%** 攻击力伤害（每个目标独立判定暴击）。冷却 **5 秒**，范围内无敌人时无法释放；CD 转好且范围内有敌人时自动释放。**顺劈效果**：使用旋风斩后的 **5 秒**内，**嗜血**或**暴怒**对主目标造成伤害时，**除主目标外**范围内最多 **4 个**敌人额外受到 **60%** 的顺劈伤害（顺劈伤害=本次对主目标造成的伤害×60%，不再次暴击）。普攻不触发顺劈。技能栏中旋风斩格会显示 **CD Xs** / **就绪** / **顺劈**（buff 中）。
- **主动技能·暴怒**：已加入基础技能池（id 16），**狂暴战开局即拥有**（占技能栏 1 格）。**消耗 100 怒气**，对当前目标造成 **200%** 攻击力伤害（可暴击）。**无 CD**，怒气≥100 且有目标时自动释放。可触发**顺劈**（顺劈 buff 期间命中主目标时，主目标外最多 4 单位受 60% 顺劈伤害）。技能栏显示 **怒气不足** / **就绪**。

### 2.2 怪物

- **刷新**：每波 10 只，按间隔（约 0.7 秒）依次出现；共 20 波。
- **移动**：从右侧向左侧移动，到达玩家 x 后停下并持续攻击玩家。
- **小怪**：基础血量 100、移速 48、攻击力 1，每 1 秒对玩家造成 1 次伤害；**每波血量** = 上一波的 150%（即第 1 波 100，第 2 波 150，第 3 波 225…）。击杀获得 1 金币、5 经验。
- **Boss**：第 5、10、15、20 波的第一只为 Boss。血量 = 该波小怪血量×6，移速 = 小怪×0.7，击杀获得 5 金币、20 经验。外观为紫色大圆 +「Boss」字样。

---

## 三、技能系统

### 3.1 基础技能池（12 张）

升级时 3 选 1，未选过的从**基础池**中随机抽取。

| 名称     | 攻击倍率 | 攻速倍率 |
|----------|----------|----------|
| 强力一击 | 1.5      | 1.0      |
| 攻速提升 | 1.0      | 1.4      |
| 双倍打击 | 2.0      | 0.8      |
| 锋芒     | 1.3      | 1.0      |
| 连击     | 1.0      | 1.6      |
| 重击     | 2.2      | 0.7      |
| 轻刃     | 0.8      | 1.8      |
| 破甲     | 1.6      | 1.0      |
| 疾风     | 1.0      | 1.5      |
| 致命     | 1.8      | 0.9      |
| 均衡     | 1.2      | 1.2      |
| 狂暴     | 1.4      | 1.3      |

另有**嗜血**（主动）、**暴击专精**（被动 +25 暴击数值，约 20% 暴击率）、**极速专精**（被动 +20 极速数值，即攻速与 CD+20%）、**旋风斩**（主动，对最多 5 个敌人造成 80% 伤害，CD 5 秒）、**暴怒**（主动，消耗 100 怒气造成 200% 伤害，无 CD，可触发顺劈）。暴击专精与极速专精可被选入 3 选 1；狂暴战开局即拥有嗜血、旋风斩、暴怒。

### 3.2 技能栏位与「吞噬」

- 最多 **7 个技能栏位**。选满后只能「跳过」升级。
- **吞噬**：当某套装的所需基础技能全部学齐时，该套装**激活**，组成该套装的那几张基础技能**不再占用栏位**（视为被套装「吞噬」），但效果与套装加成一并保留。进阶技能不参与套装，始终占 1 栏位。

### 3.3 基础套装（5 个）

每个套装由 2 张**基础技能**组成，激活后提供额外倍率。

| 套装     | 需求技能           | 效果（大致）     |
|----------|--------------------|------------------|
| 刺客     | 强力一击、锋芒     | 攻击+15%，攻速+10% |
| 战士     | 强力一击、重击     | 攻击+20%         |
| 迅捷     | 攻速提升、连击     | 攻速+25%         |
| 破势     | 破甲、致命         | 攻击+15%，攻速+10% |
| 均衡之道 | 轻刃、均衡         | 攻击+10%，攻速+20% |

### 3.4 进阶卡池（每套装独立）

- **规则**：每个基础套装对应**一个独立的进阶卡池**。只有**激活该套装后**，该套装的进阶卡才会进入升级时的 3 选 1 抽卡池。
- **进阶卡**：不参与套装、不参与吞噬，始终占 1 栏位；数值一般高于基础卡。
- **卡池对应**：
  - **刺客** 进阶：影袭、割喉  
  - **战士** 进阶：破军、碾压  
  - **迅捷** 进阶：神速、残影  
  - **破势** 进阶：裁决、崩解  
  - **均衡之道** 进阶：圆融、无双  

选技能界面会显示「已开启：刺客、战士 … 进阶卡池」，进阶卡上会标「刺客·进阶」等来源。

---

## 四、经验与升级

- 击杀小怪 +5 经验，击杀 Boss +20 经验。
- 经验满后升级：所需经验 = 10 + 当前等级×5。
- 升级时游戏暂停，弹出 3 选 1 技能（基础 + 已解锁的进阶池混合），可点「跳过」。

---

## 五、商店

- **入口**：下方面板「商店」按钮，随时可点，打开时游戏暂停。
- **货币**：金币。小怪 1 金，Boss 5 金。
- **商品**：生命药水(15)、攻击药剂(25)、攻速药剂(25)、生命上限(40)、大生命药水(35)。生命药水为**百分比回复**：生命药水恢复 15% 最大生命，大生命药水恢复 40% 最大生命；其余为永久加攻/加攻速/加生命上限。

---

## 六、装备

- **栏位**：装备栏 **6 格**，获得装备后自动填入空位，效果永久生效（与商店加成叠加）。
- **掉落**：仅**小怪**击杀时有 **1%** 概率掉落装备；Boss 不掉落。掉落时随机一件**可掉落**装备：若有空位则自动装备；若**已满**则暂停并弹出「选择替换」界面。部分装备（如职业专属）不可掉落。
- **装备列表**（10 件）：

| 名称 | 效果 | 备注 |
|------|------|------|
| 利刃 | 攻击 +10% | |
| 轻靴 | 攻速 +10% | |
| 护甲 | 生命上限 +15（并获得 15 生命） | |
| 破军刃 | 攻击 +15% | |
| 灵巧护腕 | 攻速 +12% | |
| 铁壁 | 生命上限 +25 | |
| 狂暴之握 | 攻击 +8%，攻速 +8% | |
| 疾风之靴 | 攻速 +15% | |
| 生命之种 | 攻击 +5%，生命上限 +20 | |
| 狂暴战刃 | 攻击 +50（固定）、怒气获取 +30% | **狂暴战**开局自动装备第 1 格，不可掉落 |

---

## 七、关卡与结算

- **波次**：共 20 波，每波 10 只；第 5/10/15/20 波首只为 Boss。每波结束后进入**波次间隔** 10 秒倒计时，画面中央显示「下一波」与剩余秒数，倒计时结束后开始下一波刷怪。
- **通关**：20 波全部打完且玩家存活，弹出通关界面（击杀、等级、金币、技能等），可「再来一局」。
- **失败**：玩家生命归零，弹出游戏结束界面，可「再来一局」。

---

## 八、存档与启动

- **存档**：每波结束、死亡、通关时自动写入本地（波次、等级、技能、金币、血量、装备栏、场上怪物等）；若装备栏已满且刚掉落未选替换，会保存「待替换装备」，读档后继续选择替换或放弃。
- **启动**：若有存档，进入游戏时先显示「新游戏 / 继续游戏」；选「新游戏」清空存档并从头开始，选「继续游戏」读取上次进度。「再来一局」会清空存档并重新开始。

---

## 九、界面与表现

- **布局**：顶部安全区（状态栏）、上半部分横条游戏区、下半部分套装展示 + 金币/等级/栏位/经验 + 商店按钮。
- **套装展示**：下方面板直接列出已激活的套装名称与效果，无按钮。
- **装备栏**：6 格，显示已装备名称（两字缩写或全名）或「空」。满格掉落时弹出「获得装备：xxx，选择一格替换（或放弃）」覆盖层。
- **属性与英雄**：角色属性框内显示力/敏/智、大类型与职业，以及**暴击**（数值与暴击率%）、**极速**（数值与攻速/CD+%）；**战士职业**（如狂暴战）时额外显示**怒气**条与数值（当前/上限）。
- **技能栏**：7 格，格子加大以显示技能名与状态；主动技能（如嗜血）会显示 **CD Xs** / **就绪** / **攻速+**（buff 中）。
- **选技能**：升级时居中弹窗，3 张卡 + 跳过；显示栏位、可组成套装提示、套装收集情况；若已开启进阶，显示「已开启：xx、xx 进阶卡池」，进阶卡带「xx·进阶」标签。
- **特效**：攻击命中/击杀有黄色扩散，受击有红色闪一下；音效占位已留（可后续接资源）。

---

## 十、后续可扩展（参考）

- 音效资源接入、新手引导、成就/统计、设置（音效开关）、分享等。
- 更多装备、装备从商店购买或 Boss 掉落，需同步更新本文档与代码内的常量。
- 更多波次、更多基础/进阶技能或新套装，需同步更新本文档与代码内的常量。

---

*文档与当前小游戏实现保持一致，有改动时请同步更新此文件。*
